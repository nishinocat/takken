<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>COMBO動作確認テスト</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .result-box {
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .result-box.correct {
            background: linear-gradient(135deg, #34c759, #30d158);
            color: white;
        }
        .result-box.incorrect {
            background: linear-gradient(135deg, #ff3b30, #ff453a);
            color: white;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>COMBO機能テスト</h1>
    
    <div class="info">
        <p><strong>現在のストリーク:</strong> <span id="currentStreak">0</span></p>
        <p><strong>最高ストリーク:</strong> <span id="maxStreak">0</span></p>
        <p><strong>獲得ポイント合計:</strong> <span id="totalPoints">0</span></p>
    </div>
    
    <div>
        <button onclick="answerCorrect()">正解する</button>
        <button onclick="answerIncorrect()">不正解する</button>
        <button onclick="resetTest()">リセット</button>
    </div>
    
    <div id="result" class="result-box" style="display: none;"></div>
    
    <h2>ログ：</h2>
    <div id="log" style="background: #f9f9f9; padding: 10px; border: 1px solid #ddd; height: 200px; overflow-y: auto;"></div>
    
    <script>
        let streak = 0;
        let maxStreak = 0;
        let totalPoints = 0;
        
        function addLog(message) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateDisplay() {
            document.getElementById('currentStreak').textContent = streak;
            document.getElementById('maxStreak').textContent = maxStreak;
            document.getElementById('totalPoints').textContent = totalPoints;
        }
        
        function answerCorrect() {
            // ストリーク更新
            streak++;
            addLog(`正解！ストリーク: ${streak - 1} → ${streak}`);
            
            if (streak > maxStreak) {
                maxStreak = streak;
                addLog(`最高記録更新！`);
            }
            
            // ポイント計算
            let points = 1;
            if (streak > 1) {
                const effectiveStreak = Math.min(streak, 4);
                points = Math.pow(2, effectiveStreak - 1);
                addLog(`ボーナスポイント計算: ${effectiveStreak}連続 = ${points}ポイント`);
            }
            
            totalPoints += points;
            
            // 結果表示
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'flex';
            resultDiv.className = 'result-box correct';
            
            if (streak > 1) {
                const comboText = `🎉 正解！ 🔥 ${streak} COMBO!! +${points}ポイント獲得！`;
                resultDiv.textContent = comboText;
                addLog(`COMBO表示: "${comboText}"`);
            } else {
                const normalText = `🎉 正解！ +1ポイント獲得`;
                resultDiv.textContent = normalText;
                addLog(`通常表示: "${normalText}"`);
            }
            
            updateDisplay();
        }
        
        function answerIncorrect() {
            addLog(`不正解... ストリーク: ${streak} → 0`);
            streak = 0;
            
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'flex';
            resultDiv.className = 'result-box incorrect';
            resultDiv.textContent = '❌ 不正解';
            
            updateDisplay();
        }
        
        function resetTest() {
            streak = 0;
            maxStreak = 0;
            totalPoints = 0;
            document.getElementById('result').style.display = 'none';
            document.getElementById('log').innerHTML = '';
            addLog('テストをリセットしました');
            updateDisplay();
        }
        
        // 初期表示
        updateDisplay();
        addLog('テスト開始 - 「正解する」を2回連続でクリックしてCOMBOを確認してください');
    </script>
</body>
</html>